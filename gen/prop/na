#!/bin/sh

set -e
cd "${0%/*}/../.."
exec >lib/unicode/prop/uprop_get_na.c

gawk '
BEGIN {
	FS = ";"

	print "/* This file is autogenerated by gen/prop/nv; DO NOT EDIT. */"
	print ""
	print "#include \"macros.h\""
	print "#include \"rune.h\""
	print "#include \"unicode/prop.h\""
	print ""
	print "#define _(...) \\"
	print "\t{(const char8_t []){__VA_ARGS__}, sizeof((const char8_t []){__VA_ARGS__})}"
	print ""
	print "static const struct u8view lookup[] = {"
}

$2 !~ /^</ {
	gsub(/./, "\x27&\x27, ", $2)
	sub(/, $/, "", $2)
	printf "\t[RUNE_C(0x%06X)] = _(%s),\n", strtonum("0X" $1), $2
}

END {
	print "};"
	print ""
	print "struct u8view"
	print "uprop_get_na(rune ch)"
	print "{"
	print "\treturn ch < lengthof(lookup) ? lookup[ch] : (struct u8view){};"
	print "}"
}
' data/UnicodeData.txt
